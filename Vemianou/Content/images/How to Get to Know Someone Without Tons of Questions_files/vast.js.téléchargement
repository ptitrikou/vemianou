!function(){var t="vast",e="-1",i="time",r="vmap",a=5e3,n=15e3,s="paused",o="playing",d="complete",l="error",h="adBreakIgnored",p="adComplete",u="adError",c="adImpression",f="adSkipped",m="click",v="play",y="error",g="complete",A=[c,u,"adPodError"],k=["adStarted",p,c,"adClick",f,u,"adPlay","adPause","adMeta"],P=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},w=function(){function t(e,i,r,a,n){var s=this;P(this,t),this.player=e,this.state=e.state,this.vpaidURL=r,this.adTag=a,this.adParams=n.adParams,this.vpaidControls=n.vpaidControls,this.type="vpaid",this.instream=i||e.createInstream(),this.toRemove=[],this.vpaidState={linear:!1,expanded:!1,remainingTime:-1},this.paused=!1,T(this,e.Events),this.setMuteCallback=this.setMute.bind(this),this.playerContainer=this.player.getContainer(),n.adOptOut?setTimeout(function(){s.sendEvent("error",{message:"Conditional ad rejected",code:408})},0):(this.iframe=function(t,e,i,r){var a=document.createElement("iframe");a.setAttribute("gesture","media"),a.setAttribute("allow","autoplay"),a.src="javascript:false",t.style(a,{border:0,width:"100%",height:"100%",position:"absolute",overflow:"hidden"}),a.scrolling="no";i.querySelector(".jw-media").appendChild(a);var n=a.contentWindow.document;return n.open().write("\n    <body onload=\"\n        var js = document.createElement('script');\n        js.src = '"+e+"';\n        js.addEventListener('load', function() { window.myCallback(); });\n        document.body.appendChild(js);\"\n    style=\"margin: 0\">"),a.contentWindow.myCallback=r,n.close(),a}(e.utils,this.vpaidURL,this.playerContainer,this.callback.bind(this)),this.toRemove.push(this.iframe))}return t.prototype.sendEvent=function(t,e){(e=e||{}).tag||(e.tag=this.adTag),this.trigger(t,e)},t.prototype.sendTimeEvent=function(t,e,i){var r=e.getAdDuration(),a=e.getAdRemainingTime(),n=T({duration:r},i);this.sendEvent(t,n),a>0&&(n.position=r-a,this.trigger("time",n))},t.prototype.handleQuartile=function(t,e){this.sendTimeEvent("quartile",t,{quartile:e})},t.prototype.genEvent=function(t){var e=this;return function(i){e.on(t,i)}},t.prototype.setMute=function(){this.player.setMute(!this.vpaidAd.getAdVolume())},t.prototype.userActive=function(){var t=this.player.utils.hasClass(this.playerContainer,"jw-flag-time-slider-above");this.player.utils.style(this.iframe,{bottom:t?66:60})},t.prototype.userInactive=function(){"paused"!==this.player.getState()&&this.player.utils.style(this.iframe,{bottom:"0.5em"})},t.prototype.prepareNonlinearAd=function(){var t=!this.player.utils.hasClass(this.playerContainer,"jw-flag-user-inactive");if(this.player.utils.style(this.iframe,{height:150}),this.resize(null,150),this.userActive(t),this.player.on("userActive",this.userActive,this),this.player.on("userInactive",this.userInactive,this),this.instream){this.instream.noResume=!0,this.instream.applyProviderListeners(null),this.instream.destroy(),this.instream=null;var e=this.playerContainer.querySelector(".jw-media"),i=e.querySelector("video,audio");e.insertBefore(i,this.iframe),i.play()}},t.prototype.genListeners=function(t){var e=this;return{AdLoaded:function(){t.startAd()},AdStarted:function(){t.getAdLinear()?e.vpaidControls||(e.instream=e.instream||e.player.createInstream(),e.instream.hide()):e.prepareNonlinearAd(),e.sendEvent("impression",{linear:t.getAdLinear()?"linear":"nonlinear"}),e.sendEvent("play",{oldstate:"buffering",newstate:o,linear:t.getAdLinear()?"linear":"nonlinear"}),t.subscribe(e.setMuteCallback,"AdVolumeChange",t)},AdVideoStart:function(){e.sendEvent("started")},AdStopped:function(){_(e.toRemove),e.sendEvent("stopped")},AdPaused:function(){e.paused||(e.paused=!0,e.sendEvent("pause",{newstate:s,oldstate:o}))},AdPlaying:function(){e.paused&&(e.paused=!1,e.sendEvent("play",{newstate:o,oldstate:s,linear:t.getAdLinear()?"linear":"nonlinear"}))},AdLinearChange:function(){t.getAdLinear()?(e.player.utils.style(e.iframe,{height:"100%"}),e.player.off(null,null,e),e.instream=e.instream||e.player.createInstream(),e.instream.init(),e.vpaidControls||e.instream.hide()):e.prepareNonlinearAd()},AdDurationChange:function(){e.sendTimeEvent("remainingTimeChange",t,{isDurationChange:!0,remainingTime:t.getAdRemainingTime()})},AdRemainingTimeChange:function(){e.sendTimeEvent("remainingTimeChange",t,{remainingTime:t.getAdRemainingTime()})},AdExpandedChange:function(){e.sendEvent("expandedChange",{expanded:t.getAdExpanded()})},AdSkipped:function(){_(e.toRemove),e.sendEvent("skipped")},AdVideoFirstQuartile:function(){e.handleQuartile(t,1)},AdVideoMidpoint:function(){e.handleQuartile(t,2)},AdVideoThirdQuartile:function(){e.handleQuartile(t,3)},AdVideoComplete:function(){e.sendEvent("complete")},AdUserClose:function(){e.sendEvent("close")},AdClickThru:function(t,i,r){e.sendEvent("click",{id:i,url:t,playerHandles:r})},AdError:function(t){_(e.toRemove);var i=function(t){if(t){var e=t.match(/\b(?:[34])[0-9]{2}\b/);if(e)return parseInt(e[0],10);if(t.match(/timeout/i))return t.match(/vpaid|vast/i)?301:402;if(t.match(/found/i))return 401;if(t.match(/supported/i))return 403;if(t.match(/(?:displaying|media file)/i))return 405}return 901}(t);e.sendEvent("error",{message:t,code:i,adErrorCode:5e4+i})}}},t.prototype.callback=function(){var t=this.vpaidAd=this.iframe.contentWindow.getVPAIDAd(),e=this.player.getMute()?0:this.player.getVolume()/100,i=t.handshakeVersion("2.0");if(parseFloat(i)<1)throw new Error("Invalid vpaid version in handshake");var r=this.genListeners(t);Object.keys(r).forEach(function(e){t.subscribe(r[e],e,t)}),this.listeners=r;var a={AdParameters:this.adParams},n=this.playerContainer.querySelector(".jw-media"),s=this.instream.getMediaElement(),o=this.iframe.contentWindow.document.createElement("div");o.className="jw-vpaid-wrapper",o.style.height="100%",this.iframe.contentWindow.document.body.appendChild(o);var d={videoSlot:s,slot:o};t.initAd(n.clientWidth,n.clientHeight,"normal",1e3,a,d),t.setAdVolume(e)},t.prototype.play=function(){this.vpaidAd.resumeAd()},t.prototype.pause=function(){this.vpaidAd.pauseAd()},t.prototype.stop=function(){if(this.vpaidAd)try{this.vpaidAd.stopAd()}catch(t){console.log("Unhandled exception from VPAID2 Creative stopAd",t)}},t.prototype.setVolume=function(t){this.vpaidAd.setAdVolume(t/100)},t.prototype.resize=function(t,e){if(this.vpaidAd&&this.vpaidAd.resizeAd){var i=this.player.getFullscreen()||document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?"fullscreen":"normal";this.vpaidAd.resizeAd(t||this.player.getWidth(),e||this.player.getHeight(),i)}},t.prototype.destroy=function(){if(_(this.toRemove),this.removeEvents(),this.vpaidAd)try{var t=this.listeners,e=this.vpaidAd;Object.keys(t).forEach(function(i){e.unsubscribe(t[i],i,e)}),e.unsubscribe(this.setMuteCallback,"AdVolumeChange",e)}catch(t){console.log("Unhandled exception from VPAID2 Creative",t)}this.player=null,this.instream=null},t.prototype.removeEvents=function(){this.player&&this.player.off(null,null,this),this.off()},t.prototype.attachMedia=function(){},t.prototype.detachMedia=function(){},t.prototype.volume=function(){},t.prototype.mute=function(){},t.prototype.getState=function(){return this.vpaidState.linear?this.paused?s:o:"idle"},t}();function _(t){for(;t.length>0;){var e=t.pop();e.parentNode&&e.parentNode.removeChild(e)}}var E={},b=[];var I=function(){function t(e,i,r){var a=this;P(this,t);var n=e||{};this.map=n,this.debugTrackFn=i,this.trackerPlayerUtils=(s=r,{getPosition:function(){return s.getPosition()},getFile:function(){return s.getPlaylistItem().file}});var s;this.lastQuartile=0,this.progressEvents=[],this.breakStarted=!1,this.started=!1,this.firedError=!1,this.hasComp=!1,E._.map(n,function(t,e){if(n.hasOwnProperty(e)&&0===e.indexOf("progress")){var i=""+e.split("_")[1],r={key:e,offset:i,tracked:!1,percentage:!1};/^\d+%$/.test(i)?(r.percentage=!0,r.offset=parseFloat(i)):r.offset=E.utils.seconds(i),a.progressEvents.push(r)}}),this.setFactories()}return t.prototype.getUrls=function(t){return this.map.hasOwnProperty(t)?this.map[t]:[]},t.prototype.addUrl=function(t,e){this.map.hasOwnProperty(t)?this.map[t].push(e):(this.map[t]=[],this.map[t].push(e))},t.prototype.trackPings=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getUrls(t),r=[],a=[];if(i.length){e=this.replaceMacros(e),i.forEach(function(t){if(t){E._.each(e,function(e,i){t=t.replace(i,e)});var i=new Image;i.src=t,r.push(t),a.push(i)}}),Array.prototype.push.apply(b,a);for(var n=b.length;n--&&(b[n].width||b[n].complete);)b.length=n}"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"ping",data:{pingType:t,urls:r,images:a}})},t.prototype.replaceMacros=function(t){return t["[TIMESTAMP]"]=encodeURIComponent(this.generateTimestamp()),t["[CACHEBUSTING]"]=Math.random().toString().slice(2,10),t["[ASSETURI]"]=encodeURIComponent(this.trackerPlayerUtils.getFile()),t["[CONTENTPLAYHEAD]"]=encodeURIComponent(this.convertPlayheadOffset(this.trackerPlayerUtils.getPosition())),t},t.prototype.generateTimestamp=function(){var t=new Date,e=t.getTime(),i=t.getTimezoneOffset()/60,r=6e4*t.getTimezoneOffset();return new Date(e-r).toISOString().slice(0,-1)+(i>0?"-":"+")+("0"+i).slice(-2)},t.prototype.convertPlayheadOffset=function(t){var e=("0"+Math.floor(t/3600)).slice(-2),i=("0"+Math.floor((t-3600*e)/60)).slice(-2);return e+":"+i+":"+("0"+Math.floor(t-3600*e-60*i)).slice(-2)+"."+(t%1).toFixed(3).toString().slice(2,5)},t.prototype.start=function(){this.started=!0,this.trackPings("start")},t.prototype.breakStart=function(){this.breakStarted=!0,this.trackPings("breakStart")},t.prototype.time=function(t,e){if(!(e<=1)){for(var i=(4*t+.05)/e|0;i>this.lastQuartile&&this.lastQuartile<3;)this.lastQuartile++,1===this.lastQuartile?this.trackPings("firstQuartile"):2===this.lastQuartile?this.trackPings("midpoint"):3===this.lastQuartile&&this.trackPings("thirdQuartile");this.trackProgress(t,e)}},t.prototype.trackProgress=function(t,e){for(var i=this.progressEvents.length;i--;){var r=this.progressEvents[i];if(!r.tracked){var a=r.offset;r.percentage&&(a=e*a/100),t>=a&&(r.tracked=!0,this.trackPings(r.key))}}},t.prototype.error=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:900;this.firedError=!0;var e={};e["[ERRORCODE]"]=t,this.trackPings("error",e)},t.prototype.factory=function(t){var e=this;return function(){e.trackPings(t)}},t.prototype.setFactories=function(){this.creativeView=this.factory("creativeView"),this.click=this.factory("click"),this.skip=this.factory("skip"),this.complete=this.factory("complete"),this.pause=this.factory("pause"),this.resume=this.factory("resume"),this.mute=this.factory("mute"),this.unmute=this.factory("unmute"),this.fullscreen=this.factory("fullscreen"),this.expand=this.factory("expand"),this.collapse=this.factory("collapse"),this.acceptInvitation=this.factory("acceptInvitation"),this.close=this.factory("close"),this.rewind=this.factory("rewind"),this.impression=this.factory("impression"),this.breakEnd=this.factory("breakEnd")},t}();function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:900,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60900,r={};return r.message=t,r.code=e,r.adErrorCode=i,r}function S(t,e){t.wrappedTags&&(e.wrapperAdSystem=t.wrapper||"",e.tag=t.wrappedTags.pop(),e.wrappedTags=t.wrappedTags),e.adsystem=t.adsystem||""}function x(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{type:e,client:t,adposition:null!==r?r:function(t){if(t.isBeforePlay()||0===t.getPosition())return"pre";if(t.isBeforeComplete()||t.getPosition()===t.getDuration())return"post";return"mid"}(i),viewable:i.getViewable()}}var R=function(){function e(t,i,r,a,n,s){P(this,e),this.player=i,this.staticPlayer=r,this.companion=a,this.optionalParams=n,this.debugTrackFn=s,this.scheduledAd=t.scheduledAd(),this.vastBuffet=t.adBuffet(),this.vastAdPod=t.adPod(),this.vastAd=this.vastBuffet.length?this.vastBuffet[0]:null,this.adType=null,this.vpaidPlayer=null,this.instreamPlayer=null,this.blockingInstreamPlayer=null,this.mediaType=null,this.adPodItems=null,this.creativeTimeout=null,this.vastOptions=null,this.duration=0,this.position=0,this.adPodIndex=0,this.initialIndex=0,T(this,i.Events)}return e.prototype.init=function(t){this.init=function(){throw new Error("Adplayer can only be initialized once")},this.blockingInstreamPlayer=t;return!!this.prepareAdPod()&&(this.player.on("fullscreen",this.playerFullscreenHandler,this),this.player.on("volume",this.playerVolumeHandler,this),this.player.on("mute",this.muteHandler,this),this.player.on("resize",this.playerResizeHandler,this),this.playAd())},e.prototype.prepareAdPod=function(){var t=this,e=null,i=0,r=[];if(this.vastAd&&(O(this.vastAd,this.debugTrackFn,this.player),(e=this.prepareAdPodItem(this.vastAd))&&"vpaid"===e.adType&&!H(this.vastAd)&&(e=null)),this.vastAdPod)for(var a=null,n=0;n<this.vastAdPod.length;n++){var s=this.vastAdPod[n];O(s,this.debugTrackFn,this.player);var o=this.prepareAdPodItem(s);if(o){if(a!==o.adType&&"instream"===a)break;if(a=o.adType,"vpaid"!==o.adType||H(s)){var d=r.length+i===n;o&&d&&r.push(o)}else i++}else i++}if(!r.length&&!e)return this.adError("No Compatible Creatives",403),!1;var l=void 0;return r.length?(l=r,this.vastOptions=[],l.forEach(function(e){t.vastOptions.push(t.getInstreamOptions(e.vastAd))})):(l=e,this.vastOptions=this.getInstreamOptions(this.vastAd)),this.adPodItems=l,this.adPodIndex=0,!0},e.prototype.prepareAdPodItem=function(t){t.tracker.linear="linear";var e=(""+t.media[0].adType).toLowerCase()||"instream";"vpaid"!==e||H(t)||(e="instream");var i={vastAd:t,sources:[],adType:e};this.scheduledAd.skipoffset&&(i.skipoffset=this.scheduledAd.skipoffset);var r=t.media,a={};if(E._.each(r,function(t){i.sources.push({file:t.file,mimeType:t.type,type:(""+t.type).replace(/^(?:video|audio)\/(?:x-)?/,"")}),a[t.file]={width:t.width||0,height:t.height||0}}),"instream"===e&&(i.sources=function(t){var e=void 0;return e=jwplayer.api.availableProviders.filter(function(t){return"flash"!==t.name}),t.filter(function(t){return e.some(function(e){return e.supports(t)})})}(i.sources)),0===i.sources.length)return null;this.mediaType=(""+i.sources[0].mimeType).toLowerCase(),i.vastAd.selectedMedia=i.sources[0];var n=this.player.getSafeRegion(!0),s=null,o=null;return i.sources.forEach(function(t){var e=a[t.file];e.width<=n.width&&(!s||e.width>a[s.file].width)&&(s=t),e.width>=n.width&&(!o||e.width<a[o.file].width)&&(o=t)}),s?(i.vastAd.selectedMedia=s,s.default=!0):o&&(i.vastAd.selectedMedia=o,o.default=!0),i},e.prototype.getInstreamOptions=function(t){var e=this.optionalParams.skipoffset>=0?this.optionalParams.skipoffset:null;return{skipoffset:t.skipoffset||this.scheduledAd.skipoffset||e,skipMessage:this.optionalParams.skipMessage,skipText:this.optionalParams.skipText}},e.prototype.getVastAd=function(t){if(this.adPodItems){var e=void 0;if((e=this.adPodItems.length?this.adPodItems[t]:this.adPodItems).vastAd)return e.vastAd}else if(this.vastAdPod&&this.vastAdPod.length)return this.vastAdPod[t];return this.vastAd},e.prototype.adError=function(t,e,i){clearTimeout(this.creativeTimeout);var r=this.getVastAd(this.adPodIndex),a=C(t,e,i=i||(e?1e4+e:null));if(V(r,a),M(r,a),this.vastAdPod&&this.adPodIndex<this.vastAdPod.length-1)this.triggerEvent("adPodError",a);else{r.tracker.error(a.code),S(r,a),this.addConditionalAdData(a),this.triggerEvent(u,a)}},e.prototype.playAd=function(){var t=this.adPodItems[this.adPodIndex]||this.adPodItems;if(this.adType=t.adType,"vpaid"===this.adType)return this.playVpaid(t.vastAd);if("static"===this.adType)return this.playStatic(),!0;var e=Array.isArray(this.adPodItems)?this.adPodItems.slice(this.adPodIndex):this.adPodItems,i=Array.isArray(this.vastOptions)?this.vastOptions.slice(this.adPodIndex):this.vastOptions;return this.initialIndex=this.adPodIndex,this.playInstream(e,i)},e.prototype.clearVpaidBlocking=function(){if(this.vpaidPlayer.instream){var t=this.vpaidPlayer.instream;this.vpaidPlayer.instream=null,this.clearBlocking(t)}},e.prototype.clearBlocking=function(t){(t=t||this.blockingInstreamPlayer)&&t!==this.instreamPlayer&&t.destroy()},e.prototype.getState=function(){return this.instreamPlayer?this.instreamPlayer.getState():this.vpaidPlayer?this.vpaidPlayer.getState():""},e.prototype.clearNonlinear=function(){this.staticPlayer.stop(),this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.stop(),this.vpaidPlayer.destroy(),this.vpaidPlayer=null))},e.prototype.destroy=function(){if(this.off(),this.removePlayerListeners(),this.instreamPlayer){var t=this.instreamPlayer;this.instreamPlayer=null,this.clearBlocking(t)}this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.clearNonlinear(),this.vastLoader=null,this.player=null,this.instreamPlayer=null,this.scheduledAd=null,this.vastBuffet=null,this.vastAd=null,this.vastAdPod=null},e.prototype.pause=function(){this.instreamPlayer?this.instreamPlayer.pause():this.vpaidPlayer&&this.vpaidPlayer.pause()},e.prototype.play=function(){this.instreamPlayer?this.instreamPlayer.play():this.vpaidPlayer&&this.vpaidPlayer.play()},e.prototype.removePlayerListeners=function(){this.player&&(this.player.off("fullscreen",this.playerFullscreenHandler,this),this.player.off("volume",this.playerVolumeHandler,this),this.player.off("mute",this.muteHandler,this)),this.instreamPlayer&&this.instreamPlayer.off(null,null,this),this.vpaidPlayer&&(this.vpaidPlayer.removeEvents(),this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.staticPlayer.stop(),this.staticPlayer.removeEvents()},e.prototype.adEventObject=function(e){var i=this.scheduledAd._adQueue||{},r={id:this.scheduledAd._id,tag:this.scheduledAd._currentTag,client:t,witem:this.scheduledAd._waterfallIndex||1,wcount:i.length||1,viewable:this.player.getViewable()};if(this.scheduledAd._adbreak&&(r.adschedule=this.scheduledAd._adbreak,r.adschedule.offset=this.scheduledAd._offSet),this.adPodItems&&this.adPodItems.length&&(r.sequence=this.adPodIndex+1,r.podcount=this.adPodItems.length),this.mediaType&&(r.creativetype=this.mediaType),this.scheduledAd._vmap&&(r.vmap=this.scheduledAd._vmap),-1!==k.indexOf(e)){var a=this.getVastAd(this.adPodIndex);r.universalAdIdRegistry=a.universalAdIdRegistry,r.universalAdIdValue=a.universalAdIdValue,r.categories=a.categories}return r},e.prototype.playStatic=function(){this.vastAd.tracker.linear="nonlinear";var t=this.vastAd.media[0];this.vastAd.selectedMedia=t;var e=this.vastAd.clickthrough||"",i=this.staticPlayer;i.removeEvents(),i.on("play",this.impressionHandler,this),i.on("play",this.playHandler,this),i.on("complete",this.combinedCompleteHandler,this),i.on("click",this.clickStaticHandler,this),i.on("error",this.staticErrorHandler,this),i.playAd(t.file,e,t.minDuration,this.scheduledAd._currentTag,this.scheduledAd.requestTimeout),this.clearBlocking()},e.prototype.creativeAdError=function(t,e,i){this.adError(t,e,i),this.adPodItems&&this.adPodItems.length-1>this.adPodIndex&&(this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.adPodIndex++,this.playAd())},e.prototype.playVpaid=function(t){var e=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout(function(){e.creativeAdError("VPAID tag communication timeout",900,50004)},this.scheduledAd.creativeTimeout),this.vastAd=t;var i=H(t),r=this.optionalParams.conditionaladoptout&&t.conditionalAd;if(this.vastAd.selectedMedia=i,this.mediaType=i.type,"flash"===L(i))return this.creativeAdError("Flash creatives are not supported",403,10403),!1;var a={adParams:this.vastAd.adParams,vpaidControls:this.optionalParams.vpaidcontrols,adOptOut:r};return this.vpaidPlayer=new w(this.player,this.blockingInstreamPlayer,i.file,this.scheduledAd._currentTag,a),this.blockingInstreamPlayer&&this.blockingInstreamPlayer.applyProviderListeners(this.vpaidPlayer),this.vpaidPlayer.on("play",this.playHandler,this),this.vpaidPlayer.on("pause",this.pauseHandler,this),this.vpaidPlayer.on("quartile",this.quartileHandler,this),this.vpaidPlayer.on("remainingTimeChange",this.remainingTimeHandler,this),this.vpaidPlayer.on("click",this.clickVpaidHandler,this),this.vpaidPlayer.on("error",this.playbackErrorHandler,this),this.vpaidPlayer.on("impression",this.impressionHandler,this),this.vpaidPlayer.on("expandedChange",this.vpaidExpandedHandler,this),this.vpaidPlayer.on("close",this.adCloseHandler,this),this.vpaidPlayer.on("skipped",this.vpaidAdSkipped,this),this.vpaidPlayer.on("stopped",this.endOfVpaidAdHandler,this),this.vpaidPlayer.on("complete",this.adCompleteHandler,this),this.vpaidPlayer.on("started",this.adStartedHandler,this),this.setupSkipButton(),!0},e.prototype.setupSkipButton=function(){var t=this.optionalParams.skipoffset;t&&this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(f,this.skipVpaidAd,this),this.blockingInstreamPlayer.setupSkipButton(t,this.optionalParams,E.utils.noop),this.blockingInstreamPlayer.on(f,this.skipVpaidAd,this))},e.prototype.playInstream=function(t,e){var i=this,r=this.player.getEnvironment().OS;return r.android&&2===r.version.major&&3===r.version.minor?(this.adError("Android 2.3 not supported",900),!1):(clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout(function(){i.creativeAdError("VAST tag communication timeout",900,60004)},this.scheduledAd.creativeTimeout),this.blockingInstreamPlayer?this.instreamPlayer=this.blockingInstreamPlayer:this.instreamPlayer=this.player.createInstream().init(),this.instreamPlayer.on("play",this.playHandler,this),this.instreamPlayer.on("pause",this.pauseHandler,this),this.instreamPlayer.on("time",this.timeHandler,this),this.instreamPlayer.on("playlistItem",this.playlistItemHandler,this),this.instreamPlayer.on("complete",this.adCompleteHandler,this),this.instreamPlayer.on("playlistComplete",this.endOfAdBreakHandler,this),this.instreamPlayer.on("mute",this.muteHandler,this),this.instreamPlayer.on("instreamClick",this.clickInstreamHandler,this),this.instreamPlayer.on("adSkipped",this.adSkipped,this),this.instreamPlayer.on("error",this.playbackErrorHandler,this),this.instreamPlayer.on("mediaError",this.playbackErrorHandler,this),this.instreamPlayer.on("destroyed",function(){i.instreamPlayer=null},this),this.instreamPlayer.loadItem(t,e),this.clearBlocking(),!0)},e.prototype.playerFullscreenHandler=function(t){var e=this.getVastAd(this.adPodIndex).tracker;t.fullscreen&&e.started&&e.fullscreen()},e.prototype.playerResizeHandler=function(t){this.vpaidPlayer&&this.vpaidPlayer.resize(t.width,t.height)},e.prototype.playerVolumeHandler=function(t){this.vpaidPlayer&&this.vpaidPlayer.setVolume(t.volume)},e.prototype.playlistItemHandler=function(t){this.instreamPlayer&&(this.adPodIndex=t.index+this.initialIndex)},e.prototype.impressionHandler=function(t){var e=this.getVastAd(this.adPodIndex),i=e.tracker;i.impression();var r={};r.adposition=this.scheduledAd._position||"",r.adtitle=e.adTitle||"",S(e,r),r.vastversion=e.vastversion,r.clickThroughUrl=e.clickthrough,r.duration=e.duration||0,r.mediafile={file:e.selectedMedia.file},r.linear=t.linear||i.linear,this.addConditionalAdData(r),V(e,r),M(e,r),this.triggerEvent(c,r)},e.prototype.playHandler=function(t){clearTimeout(this.creativeTimeout);var e=this.getVastAd(this.adPodIndex),i=e.tracker,r=void 0;if(i.started)t.oldstate===s&&(i.resume(),this.dispatchPlay(t));else{this.vpaidPlayer&&(i.linear=t.linear),this.instreamPlayer&&this.impressionHandler({linear:i.linear});var a=T({linear:i.linear},this.getInstreamOptions(e));a.adMessage=this.optionalParams.dynamicMessage||"",a.clickThroughUrl=e.clickthrough,a.sequence&&(a.podMessage=this.optionalParams.podMessage||""),e.adTitle&&(a.adtitle=e.adTitle),e.companions&&(a.companions=e.companions),M(e,a),this.triggerEvent("adMeta",a),e.companions&&((r={}).companions=(l=e.companions,E._.map(l,function(t){var e="iframe"===t.type||"html"===t.type?t.type:"static",i=void 0;return t.trackers&&t.trackers.creativeView&&t.trackers.creativeView.length&&(i=t.trackers.creativeView),{width:t.width,height:t.height,type:e,resource:t.source,creativeview:i,click:t.clickthrough}})),r.universalAdIdRegistry=e.companionUniversalAdIdRegistry,r.universalAdIdValue=e.companionUniversalAdIdValue,this.triggerEvent("adCompanions",r));var n=this.companion,o=void 0;E.utils.flashVersion()>9?o=e.companions:(d=e.companions,o=E._.filter(d,function(t){return t.type.indexOf("flash")<0})),this.optionalParams.companion&&o&&o.length&&(i.hasComp=n.addCompanion(this.optionalParams.companion,o)),i.start(),i.creativeView(),this.dispatchPlay(t)}var d,l},e.prototype.dispatchPlay=function(t){if("static"!==this.adType&&("vpaid"!==this.adType||"linear"===t.linear)){var e=t.oldstate,i=t.newstate,r={};r.oldstate=e,r.newstate=i,this.triggerEvent("adPlay",r),this.vpaidPlayer&&this.vpaidPlayer.trigger("state",r)}},e.prototype.pauseHandler=function(t){this.getVastAd(this.adPodIndex).tracker.pause();var e=t.oldstate,i=t.newstate,r={};r.oldstate=e,r.newstate=i,this.triggerEvent("adPause",r),this.vpaidPlayer&&this.vpaidPlayer.trigger("state",{newstate:i,oldstate:e})},e.prototype.remainingTimeHandler=function(t){t.duration?this.duration=t.duration:this.duration=Math.max(1,this.duration,t.remainingTime);var e=t.remainingTime>=0?this.duration-t.remainingTime:0;this.timeHandler({position:e,duration:this.duration,isDurationChange:t.isDurationChange})},e.prototype.quartileHandler=function(t){if(t.duration)this.duration=t.duration;else{var e=4*t.remainingTime/(4-t.quartile);this.duration=Math.max(this.duration,1,e)}this.timeHandler({position:this.duration*t.quartile*.25,duration:this.duration})},e.prototype.timeHandler=function(t){var e=this.getVastAd(this.adPodIndex),i=t.position,r=t.duration,a=r-i,n=e.tracker,s=this.optionalParams.dynamicMessage||"",o=this.optionalParams.podMessage||"";if(s&&a>0){if(s=s.replace(/xx/gi,""+Math.ceil(a)),this.adPodItems&&this.adPodItems.length>1&&o){var d=this.adPodIndex+1;s=(o=(o=o.replace(/__AD_POD_CURRENT__/g,""+d)).replace(/__AD_POD_LENGTH__/g,""+this.adPodItems.length))+" "+s}this.instreamPlayer?this.instreamPlayer.setText(s):this.vpaidPlayer&&this.vpaidPlayer.instream&&this.vpaidPlayer.instream.setText(s)}if(!t.isDurationChange){n&&n.time(i,r);var l={};l.position=this.position=i,l.duration=r,this.triggerEvent("adTime",l)}},e.prototype.combinedCompleteHandler=function(){this.adCompleteHandler(),this.endOfAdBreakHandler()},e.prototype.adCompleteHandler=function(){var t=this.getVastAd(this.adPodIndex).tracker;t.firedError||(t.complete(),this.triggerEvent(p))},e.prototype.adCloseHandler=function(){var t=this.getVastAd(this.adPodIndex).tracker;t.firedError||t.close()},e.prototype.adStartedHandler=function(){this.triggerEvent("adStarted")},e.prototype.endOfVpaidAdHandler=function(){if(this.adPodItems&&this.adPodItems.length-1>this.adPodIndex)return this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.adPodIndex++,void this.playAd();this.endOfAdBreakHandler()},e.prototype.endOfAdBreakHandler=function(){this.removePlayerListeners(),this.trigger(p)},e.prototype.muteHandler=function(t){var e=this.getVastAd(this.adPodIndex).tracker;e&&(t.mute?(e.mute(),this.vpaidPlayer&&this.vpaidPlayer.setVolume(0)):(e.unmute(),this.vpaidPlayer&&this.vpaidPlayer.setVolume(this.player.getVolume()/100)))},e.prototype.clickStaticHandler=function(){var t=this.getVastAd(this.adPodIndex);this.player.pause(!0),this.clickThrough(t)},e.prototype.clickVpaidHandler=function(t){var e=this.getVastAd(this.adPodIndex),i=!0;t&&t.url&&(!1===t.playerHandles&&(i=!1),e.clickthrough=t.url),this.clickThrough(e,i)},e.prototype.clickInstreamHandler=function(){this.instreamPlayer.getState()!==s&&this.clickThrough(this.getVastAd(this.adPodIndex))},e.prototype.clickThrough=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.tracker.click();var i={};t.clickthrough&&(i.clickThroughUrl=t.clickthrough),this.triggerEvent("adClick",i),window.jwcast&&window.jwcast.player.id||t.clickthrough&&e&&window.open(t.clickthrough)},e.prototype.skipVpaidAd=function(){this.endOfVpaidAdHandler(),this.vpaidAdSkipped()},e.prototype.vpaidAdSkipped=function(){this.adSkipped(),this.endOfVpaidAdHandler()},e.prototype.adSkipped=function(){var t=this.getVastAd(this.adPodIndex);t.tracker.skip();var e=this.optionalParams.skipoffset;this.triggerEvent(f,{duration:t.duration,skipoffset:e,position:this.position,watchedPastSkipPoint:this.position-e})},e.prototype.playbackErrorHandler=function(t){var e=t.message||"Error Playing Ad Tag",i=t.code;(!i||i<=4)&&(i=400),this.vpaidPlayer&&"function"==typeof this.vpaidPlayer.off?(this.vpaidPlayer.off(),this.creativeAdError(e,i,t.adErrorCode)):this.adError(e,i,t.adErrorCode)},e.prototype.staticErrorHandler=function(){this.adError("Unable to fetch NonLinear resource",502)},e.prototype.vpaidExpandedHandler=function(t){var e=this.getVastAd(this.adPodIndex).tracker;t.expanded?e.expand():e.collapse()},e.prototype.triggerEvent=function(t,e){var i=this.adEventObject(t);e&&T(i,e),-1!==A.indexOf(t)?this.trigger(t,i):this.player.trigger(t,i)},e.prototype.addConditionalAdData=function(t){this.vastAd&&(t.conditionalAd=this.vastAd.conditionalAd),this.vastAdPod&&this.vastAdPod.length&&(t.conditionalAd=this.vastAdPod[this.adPodIndex].conditionalAd),t.conditionalAdOptOut=this.optionalParams.conditionaladoptout},e}();function V(t,e){"boolean"==typeof t.mediaFileCompliance&&(e.mediaFileCompliance=t.mediaFileCompliance,t.nonComplianceReasons&&(e.nonComplianceReasons=t.nonComplianceReasons))}function M(t,e){e.request=t.request,e.response=t.response}function L(t){return"application/javascript"===(e=t).type||"application/x-javascript"===e.type?"html5":"flash";var e}function H(t){for(var e=void 0,i=0;i<t.media.length;i++){var r=t.media[i];if("html5"===L(r)){e=r;break}}return e}function O(t,e,i){t.tracker=new I(t.trackers,e,i)}var B=function(){function t(e,i){P(this,t),this.debugTrackFn=e,this.div=null,this.elem=null,this.environment=i}return t.prototype.addCompanion=function(t,e){if(this.div=t,this.elem=document.getElementById(this.div.id),!this.elem)return!1;for(var i=0;i<e.length;i++)if(this.fitsDiv(e[i]))return this.placeCompanion(e[i]),!0;return!1},t.prototype.removeCompanion=function(){this.elem.innerHTML=""},t.prototype.sendPings=function(t){(t=t.creativeView)&&(t.forEach(function(t){(new Image).src=t}),"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"companion",data:{trackers:t}}))},t.prototype.placeCompanion=function(t){if(this.removeCompanion(),"html"===t.type){var e=document.createElement("div");e.innerHTML=t.source;var i=e.getElementsByTagName("script");return i.length&&E._.map(i,function(t){new E.utils.scriptloader(t.src).load(),t.parentElement.removeChild(t)}),this.elem.appendChild(e),void this.sendPings(t.trackers)}if("iframe"===t.type){var r=document.createElement("iframe");return r.height=this.div.height,r.width=this.div.width,r.src=t.source,r.scrolling="no",r.style.border="none",r.marginWidth=0,r.marginHeight=0,this.sendPings(t.trackers),this.elem.innerHTML="",void this.elem.appendChild(r)}if("application/x-shockwave-flash"===t.type){var a=document.createElement("object");return a.setAttribute("type","application/x-shockwave-flash"),a.setAttribute("data",t.source),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("tabindex",0),q(a,"allowfullscreen","true"),q(a,"allowscriptaccess","always"),q(a,"seamlesstabbing","true"),q(a,"wmode","opaque"),this.elem.appendChild(a),void this.sendPings(t.trackers)}var n=new Image;n.src=t.source,E.utils.exists(t.clickthrough)&&(n.onclick=function(){window.open(t.clickthrough,"_blank").focus()}),this.elem.innerHTML="",this.elem.appendChild(n),this.sendPings(t.trackers)},t.prototype.fitsDiv=function(t){return t.width===this.div.width&&t.height===this.div.height},t}();function q(t,e,i){var r=document.createElement("param");r.setAttribute("name",e),r.setAttribute("value",i),t.appendChild(r)}var j=function(){function t(e){P(this,t),this.preRoll=null,this.vmap=null,this.postRoll=null,this.midRolls=[],this.playedMidRolls=[],this.adRules=e}return t.prototype.setPreRoll=function(t){this.preRoll=t},t.prototype.getPreRoll=function(){return U(this.preRoll,this.requestTimeout,this.creativeTimeout)},t.prototype.getPostRoll=function(){var t=U(this.postRoll,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(t)?t:null},t.prototype.getLastMidRollBetweenTime=function(t,e,i){if(t>e)return null;for(var r=this.midRolls.length;r--;){var a=this.midRolls[r],n=D(this.midRolls[r]._offSet,i);if(t>=n)return null;if(e>=n){var s=U(a,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(s)?s:null}}return null},t.prototype.getNextMidRoll=function(t,e,i){if(this.sort(i),this.adRules.options.timeBetweenAds)return this.getLastMidRollBetweenTime(t,e,i);if(this.midRolls.length>this.playedMidRolls.length){var r=this.getClosestIndex(e,i);if(r>=0&&this.playedMidRolls.indexOf(r)<0){var a=this.midRolls[r];return this.playedMidRolls.push(r),U(a,this.requestTimeout,this.creativeTimeout)}}return null},t.prototype.getMidRolls=function(){var t=[];return E.utils.foreach(this.midRolls,function(e,i){t.push(U(i))}),t},t.prototype.reset=function(){this.playedMidRolls=[]},t.prototype.addMidRoll=function(t){this.midRolls.push(t)},t.prototype.setPostRoll=function(t){this.postRoll=t},t.prototype.sort=function(t,e){(!t||t<1)&&(t=1),this.midRolls.sort(function(e,i){return D(e._offSet,t)-D(i._offSet,t)}),function(t,e){for(var i=0;i<t.length;i++){var r=t[i];e?r._vmap.item=i+1:r._adbreak={item:i+1,tags:r._adQueue,breakid:r._breakId}}}(this.getAllAds(),e)},t.prototype.getAllAds=function(){var t=this.preRoll?[this.preRoll]:[],e=this.postRoll?[this.postRoll]:[];return t.concat(this.midRolls,e)},t.prototype.getAdScheduleEventObject=function(){var t=this.getAllAds(),e=[],i={tag:this.getVMAP(),client:"vast",adbreaks:[]};return E.utils.foreach(t,function(t,i){var r={type:i._type,offset:i._offSet};i._vmap?r.vmap=i._vmap:r.adbreak=i._adbreak,e.push(r)}),i.adbreaks=e,i},t.prototype.setVMAP=function(t){this.vmap=t},t.prototype.isVMAP=function(){return!!this.vmap},t.prototype.getVMAP=function(){return this.vmap},t.prototype.getClosestIndex=function(t,e){for(var i=this.midRolls.length;i--;)if(t>=D(this.midRolls[i]._offSet,e))return i;return-1},t}();function U(t,e,i){var r=void 0;return E.utils.foreach(t,function(t,e){(r=r||{})[t]="_adQueue"===t?e.slice():e}),r&&(r.requestTimeout=e,r.creativeTimeout=i),r}function D(t,e){return"%"===t.toString().slice(-1)?e*parseFloat(t.slice(0,-1))/100:parseFloat(t)}var N=function(){function t(){P(this,t)}return t.prototype.getSchedule=function(t,e){var i=new j(e);if(i.requestTimeout=Q(t.requestTimeout,a),i.creativeTimeout=Q(t.creativeTimeout,n),t.tag)i.setPreRoll({_offSet:"pre",_adQueue:F(t.tag),_waterfallIndex:0});else if("string"==typeof t.vastxml)i.setPreRoll({_offSet:"pre",_adXML:t.vastxml});else{if("string"==typeof t.schedule)return i.setVMAP(t.schedule),i;if("string"==typeof t.adschedule)return i.setVMAP(t.adschedule),i;!function(t,e){var i=e.schedule||e.adschedule;if(!i)return;Object.keys(i).forEach(function(r){var s=i[r];s.ad&&(T(s,s.ad),delete s.ad);var o=function(t){if("start"===t||"0%"===t)return"pre";if("end"===t||"100%"===t)return"post";if("pre"===t||"post"===t||E._.indexOf(t,"%")>-1)return t;var e=E.utils.seconds(t);if("number"==typeof e)return e;return!1}(s.offset),d=Q(s.requestTimeout,a),l=Q(s.creativeTimeout,n),h={_offSet:o,_type:s.type,_breakId:r,requestTimeout:d,creativeTimeout:l};!1===o&&E.utils.log("Error: ad offset format not supported",o);var p=s.skipoffset||e.skipoffset;void 0!==p&&(h.skipoffset=p);var u=s.adbreakid;u&&(h.adbreakid=u);var c=s.adtagid;if(c&&(h._adTagQueue=F(c)),s.tag){var f=function(t,e){if(!e)return t;var i=t.indexOf("?")>=0?"&":"?",r=t.indexOf("cust_params="),a="cust_params=".length,n="",s="";if(E.utils.foreach(e,function(t,e){n=""+n+s+t+"="+e,s="&"}),n=encodeURIComponent(n),r>=0){var o=t.substr(0,r+a),d=t.substr(r+a);return""+o+n+"%26"+d}return""+t+i+"cust_params="+n}(s.tag,s.custParams);h._adQueue=F(f),h._waterfallIndex=0}else{if("string"!=typeof s.vastxml)return void E.utils.log("Error: no ad tag provided");h._adXML=s.vastxml}switch(o){case"pre":t.setPreRoll(h);break;case"post":t.setPostRoll(h);break;default:t.addMidRoll(h)}})}(i,t)}return i.sort(),i},t.prototype.getOptParams=function(t){var e={cuetext:t.cuetext||"Advertisement",dynamicMessage:t.admessage||"This ad will end in xx",podMessage:t.podmessage||"Ad __AD_POD_CURRENT__ of __AD_POD_LENGTH__. ",skipoffset:t.skipoffset||-1,skipMessage:t.skipmessage||"Skip ad in xx",skipText:t.skiptext||"Skip",vpaidcontrols:t.vpaidcontrols||!1,conditionaladoptout:t.conditionaladoptout||!1},i=t.companiondiv;return i&&(e.companion={id:i.id,height:i.height,width:i.width}),e},t.prototype.getAdRules=function(t){var e=t.rules||{};return{startOn:e.startOn||1,frequency:void 0!==e.frequency?e.frequency:1,timeBetweenAds:e.timeBetweenAds||0}},t}();function F(t){return"string"==typeof t?[t]:Array.isArray(t)?t.slice(0):t}function Q(t,e){return 0===t?1/0:t||e}var W=document.createElement("img"),X=document.createElement("img");W.src=X.src='data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" fill="#191919"/><line stroke="#CCC" stroke-width="6" x1="32" y1="20" x2="32" y2="44"/><line stroke="#CCC" stroke-width="6" x1="20" y1="32" x2="44" y2="32"/></svg>',W.className="jw-vast-nonlinear-open-button",X.className="jw-vast-nonlinear-close-button";var z={cursor:"pointer",position:"absolute",margin:"auto",left:0,right:0,bottom:0,display:"block"},$={"-webkit-transition":"opacity 0.2s",transition:"opacity 0.2s"};function G(t,e){E.utils.style(t,{opacity:e||1})}function J(t){E.utils.style(t,{opacity:0})}function Y(){G(X)}function Z(){G(X,.75)}function K(){G(W)}function tt(){G(W,.5)}var et=function(){function t(e,i,r,a,n){P(this,t),this.player=e,this.environment=e.getEnvironment(),this.div=a,this.staticURL=i,this.clickURL=r,this.loadTimer=-1,this.animationTimer=-1,this.banner=null,T(this,e.Events),this.banner=document.createElement("img"),this.banner.className="jw-banner",this.banner.id=this.player.id+"_vast_static",J([X,W]),this.remove(W),this.div.appendChild(this.banner),this.div.appendChild(X),this.loadTimer=setTimeout(this.imageLoadError.bind(this),n),this.banner.onerror=this.imageLoadError.bind(this),this.banner.onload=this.onLoaded.bind(this),this.banner.src=this.staticURL}return t.prototype.onLoaded=function(){clearTimeout(this.loadTimer),0!==this.banner.naturalWidth?(this.removeBannerEventListeners(),E.utils.style(X,{top:-this.banner.height-8,bottom:this.banner.height-8,left:this.banner.width},!0),E.utils.style(W,{top:-16},!0),G([this.div,this.banner]),G(X,.75),new E.utils.UI(this.banner).on("click tap",this.sendClick.bind(this)),this.environment.OS.mobile&&(this.div.onmouseover=Y,this.div.onmouseout=Z),X.onclick=X.ontouchstart=this.collapse.bind(this),W.onclick=W.ontouchstart=this.expand.bind(this),this.trigger(v)):this.imageLoadError()},t.prototype.imageLoadError=function(){clearTimeout(this.loadTimer),this.trigger(y),this.removeBanner()},t.prototype.sendClick=function(){this.trigger(m)},t.prototype.collapse=function(t){var e=this;-1===this.animationTimer&&(t.preventDefault(),this.div.onmouseover=this.div.onmouseout=null,J([this.banner,X,W]),this.div.appendChild(W),this.animationTimer=setTimeout(function(){e.remove(e.banner),e.remove(X),G(W,.5),e.div.onmouseover=K,e.div.onmouseout=tt,e.animationTimer=-1},250))},t.prototype.expand=function(t){var e=this;-1===this.animationTimer&&(t.preventDefault(),this.div.onmouseover=this.div.onmouseout=null,this.div.appendChild(this.banner),this.div.appendChild(X),this.animationTimer=setTimeout(function(){G([e.banner,X]),e.div.onmouseover=Y,e.div.onmouseout=Z,e.animationTimer=-1},50),J(W))},t.prototype.remove=function(t){this.div.contains(t)&&this.div.removeChild(t)},t.prototype.removeBannerEventListeners=function(){this.banner.onload=this.banner.onerror=null},t.prototype.removeBanner=function(){this.removeBannerEventListeners(),this.remove(this.banner)},t.prototype.removeListeners=function(){clearTimeout(this.loadTimer),clearTimeout(this.animationTimer),this.div.onmouseover=this.div.onmouseout=X.onclick=W.onclick=null,this.off(),this.removeBannerEventListeners()},t.prototype.stop=function(){J([this.div,this.banner,X,W]),setTimeout(this.removeBanner.bind(this),400),this.remove(X),this.remove(W)},t}(),it=function(){function t(e,i){P(this,t),this.player=e,this.div=i,this.startTime=0,this.minDur=0,this.environment=e.getEnvironment(),T(this,e.Events),this.type="static",e.on("time",this.dispatchTime,this)}return t.prototype.playAd=function(t,e,i,r,a){this.minDur=E.utils.seconds(i),this.adTag=r,this.static&&(this.static.removeListeners(),this.static.stop()),this.div.style.opacity=0,this.div.style.visibility="visible";var n=this.environment.Browser.firefox?{}:$;E.utils.style(this.div,E.utils.extend({top:"",position:"absolute",width:"100%"},n)),E.utils.style([X,W],T({width:"18px",height:"18px",opacity:.75},z,n)),E.utils.style(X,{transform:"rotate(45deg)"}),this.static=new et(this.player,t,e,this.div,a),this.static.on(v,this.startAd,this),this.static.on(m,this.clickHandler,this),this.static.on(y,this.errorHandler,this)},t.prototype.dispatchTime=function(t){this.trigger(i,t)},t.prototype.startAd=function(){this.startTime=this.player.getPosition(),this.minDur>0&&(0===this.startTime?this.on(i,this.startTimingAd,this):this.on(i,this.timeAd,this)),this.sendEvent(v)},t.prototype.startTimingAd=function(t){this.startTime=t.position,this.off(i,this.startTimingAd,this),this.on(i,this.timeAd,this)},t.prototype.timeAd=function(t){t.position-this.startTime>this.minDur&&(this.off(i,this.timeAd,this),this.stop())},t.prototype.clickHandler=function(){this.sendEvent(m)},t.prototype.errorHandler=function(){this.sendEvent(y)},t.prototype.sendEvent=function(t,e){(e=e||{}).tag=e.tag||this.adTag,this.trigger(t,e)},t.prototype.removeEvents=function(){this.off()},t.prototype.getState=function(){return o},t.prototype.stop=function(){this.startTime&&this.static&&(this.startTime=0,this.minDur=0,this.off(i,this.startTimingAd,this),this.off(i,this.timeAd,this),this.static.removeListeners(),this.static.stop(),this.sendEvent(g))},t.prototype.pause=function(){},t}();function rt(t,e,i){var r=C(e,1002,11002);r.id=i,t.push(r)}function at(){var t=new Error("No AdBreaks in VMAP");throw t.adErrorCode=60005,t}var nt=function(){function t(e){P(this,t),this._parsedAds=[],this._error=null,this._version=null,e&&this.parse(e)}return t.prototype.parsedAds=function(){return this._parsedAds},t.prototype.error=function(){return this._error},t.prototype.version=function(){return this._version},t.prototype.parse=function(t,e){var i=this,r=void 0,a=void 0;"VAST"===t.nodeName?r=t:(r=st(t,"VAST")[0])||(r=st(t,"VideoAdServingTemplate")[0]),r||this.throwError(101,"Invalid VAST response"),a="VideoAdServingTemplate"===r.tagName?1:parseFloat(dt(r,"version")||0),this._version=a;var n=st(r,"Ad"),s=E._.map(n,function(r){var n=i.parseAd(a,r);return n.vastversion=a,n.response=t,n.request=e||null,n});this._parsedAds=s,this._parsedAds.length||function(t){var e=st(t,"Error");E._.each(e,function(t){var e=ht(t),i=new Image;i.src=e})}(r)},t.prototype.parseAd=function(t,e,i){i=i||{};var r=st(e,"InLine")[0],a=st(e,"Wrapper")[0],n=r||a,s=n?ht(st(n,"AdTitle")[0]):"",o=void 0;return i.sequence=dt(e,"sequence"),i.adTitle=s,(!t||t>4||t<2)&&this.throwError(102,"Vast version not supported"),4===t&&(i.conditionalAd=!!dt(e,"conditionalAd")),n?(t>=2?(ut(n,"Impression",(o=function(t){var e=st(st(t,"Creatives")[0],"Creative"),i={},r={trackers:i};r.adsystem=ht(st(t,"AdSystem")[0]);var a=st(t,"Category");return r.categories=E._.map(a,function(t){return ht(t)}),E._.each(e,function(t){var e=st(t,"Linear")[0],a=st(t,"NonLinear")[0],n=st(st(t,"TrackingEvents")[0],"Tracking"),s=st(t,"UniversalAdId")[0],o=dt(s,"idRegistry")||"unknown",d=dt(s,"idValue")||"unknown";e||a?(E._.each(n,function(t){lt(i,t)}),r.universalAdIdRegistry=o,r.universalAdIdValue=d):(r.companionUniversalAdIdRegistry=o,r.companionUniversalAdIdValue=d);var l=ht(st(t,"AdParameters")[0]);if(l&&(r.adParams=l),e){var h=st(e,"VideoClicks")[0],p=ht(st(h,"ClickThrough")[0]),u=st(h,"ClickTracking"),c=dt(e,"skipoffset"),f=ht(st(e,"Duration")[0]);E._.each(u,function(t){pt(i,"click",ht(t))}),f&&(r.duration=E.utils.seconds(f)),p&&(r.clickthrough=p),c&&(r.skipoffset=c),ct(e,r)}else if(a){var m=ht(st(a,"NonLinearClickThrough")[0]);m&&(r.clickthrough=m),function(t,e){var i=[],r=st(t,"StaticResource")[0];r&&(i.push({type:dt(r,"creativeType"),file:ht(r),adType:dt(st(t,"NonLinear")[0],"apiFramework")||"static",minDuration:dt(st(t,"NonLinear")[0],"minSuggestedDuration")||"00:00:00"}),e.media=i)}(t,r)}else!function(t,e){var i=st(st(t,"CompanionAds")[0],"Companion"),r=e.companions?e.companions:[];E._.each(i,function(t){var e=st(t,"StaticResource")[0],i=st(t,"IFrameResource")[0],a=st(t,"HTMLResource")[0],n={},s=void 0,o=void 0;if(e)s=dt(e,"creativeType"),o=ht(e);else if(i)s="iframe",o=ht(i);else{if(!a)return;s="html",o=ht(a)}var d=st(st(t,"TrackingEvents")[0],"Tracking");E._.each(d,function(t){var e=dt(t,"event");pt(n,e,ht(t))});var l=ht(st(t,"CompanionClickThrough")[0]);r.push({width:parseInt(dt(t,"width"),10),height:parseInt(dt(t,"height"),10),type:s,source:o,trackers:n,clickthrough:l})}),e.companions=r}(t,r)}),r}(n)).trackers),ut(n,"Error",o.trackers)):o=function(t){var e=st(t,"Video")[0]||t,i=st(t,"NonLinear")[0],r={},a={trackers:r};if(e){var n=st(st(t,"TrackingEvents")[0],"Tracking");E._.each(n,function(t){lt(r,t)});var s=st(st(t,"Impression")[0],"URL");E._.each(s,function(t){pt(r,"impression",ht(t))});var o=st(st(t,"Error")[0],"URL");E._.each(o,function(t){pt(r,"error",ht(t))});var d=st(e,"VideoClicks")[0],l=ht(st(d,"ClickThrough")[0]),h=st(st(d,"ClickTracking")[0],"URL");E._.each(h,function(t){pt(r,"click",ht(t))}),l&&(a.clickthrough=l),ct(e,a);var p=st(e,"AdParameters")[0];if(p){var u=dt(p,"apiFramework");"vpaid"===u.toLowerCase()&&(E._.each(a.media,function(t){t.adType=u}),a.adParams=ht(p))}}if(i){var c=a.media||[],f=st(i,"URL")[0];c.push({type:dt(i,"creativeType"),file:ht(f),adType:dt(i,"apiFramework")}),a.media=c}var m=st(t,"CompanionAds")[0];return m=st(m,"Companion"),a.companions=(a.companions||[]).concat(E._.map(m,function(t){return{width:parseInt(dt(t,"width"),10),height:parseInt(dt(t,"height"),10),type:dt(t,"resourceType"),resource:ht(st(t,"URL")[0]),trackers:[],clickthrough:""}})),a}(n),function(t){var e={};E._.each(t.media,function(t){var i=t.type,r="application/x-mpegURL"===i||"vnd.apple.mpegURL"===i;"vpaid"===t.adType.toLowerCase()||r||(e[i]=e[i]||0,e[i]++)}),t.mediaFileCompliance=!0,E._.each(e,function(e,i){e<3&&(t.mediaFileCompliance=!1,t.nonComplianceReasons=t.nonComplianceReasons||[],t.nonComplianceReasons.push(i+" has only "+e+" qualities"))})}(o),a&&(o.wrappedURI=ht(st(a,"VASTAdTagURI")[0])||ht(st(a,"VASTAdTagURL")[0])),o=function(t,e){var i=T({},t);return E.utils.foreach(e,function(t,r){E.utils.exists(i[t])?Array.isArray(r)?i[t]=i[t].concat(r):"object"===E.utils.typeOf(r)?i[t]=T(i[t],e[t]):i[t]=r:i[t]=r}),i}(i,o)):2===t?this.throwError(900,"Invalid VAST response",60001):this.throwError(101,"Invalid VAST response",10101),o},t.prototype.throwError=function(t,e,i){var r=this,a=C(e,t,i=i||1e4+t);throw a.toString=function(){return r.code+" "+r.message},this._error=a,this._error},t}();function st(t,e,i){var r=[];return t&&(r=t.getElementsByTagName(e),i&&r&&0===r.length&&(r=t.getElementsByTagName(i+":"+e))),r}function ot(t,e,i,r){var a=[];return t||e?a=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t,i):e.getElementsByTagName(r+":"+i):a}function dt(t,e){return t?t.getAttribute(e):null}function lt(t,e){var i=dt(e,"event");if("progress"===i){i=i+"_"+dt(e,"offset")}pt(t,i,ht(e))}function ht(t){if(t){var e=t.textContent||t.text;if(e)return E.utils.trim(e)}return""}function pt(t,e,i){t[e]||(t[e]=[]),i&&t[e].push(i)}function ut(t,e,i){var r=st(t,e);E._.each(r,function(t){pt(i,e.toLowerCase(),ht(t))})}function ct(t,e){var i=st(st(t,"MediaFiles")[0],"MediaFile"),r=e.media?e.media:[];e.media=r.concat(E._.map(i,function(t){return{type:dt(t,"type"),file:ht(t),adType:dt(t,"apiFramework")||"",width:parseInt(dt(t,"width"),10)||0,height:parseInt(dt(t,"height"),10)||0}}).filter(function(t){return t.file}))}var ft=function(){function t(e,i,r){P(this,t),this._scheduledAd=e,this.player=i,this.options=r||{},T(this,i.Events),this._history=[],this.loadedAds=[],this.parser=null,this.xmlhttp=null,this.errorSent=!1}return t.prototype.load=function(t){this._history.push(t),this.errorSent=!1,this.xmlhttp=this.getXhrRequest(t)},t.prototype.getXhrRequest=function(t){var e=this;return E.utils.ajax(t,function(i){e.ajaxComplete(i,t)},function(i){e.player&&e.ajaxError(i,t)},{withCredentials:!0,retryWithoutCredentials:!0,requireValidXML:!0,timeout:this._scheduledAd.requestTimeout})},t.prototype.destroy=function(){(t=this.xmlhttp)&&(t.onload=null,t.onreadystatechange=null,t.onerror=null,t.abort&&t.abort());var t;this.player=null},t.prototype.scheduledAd=function(){return this._scheduledAd},t.prototype.allAds=function(){return this.loadedAds},t.prototype.adPod=function(){var t=[];return this.loadedAds.forEach(function(e){e.sequence&&t.push(e)}),t.sort(function(t,e){return t.sequence-e.sequence}),t},t.prototype.adBuffet=function(){var t=[];return this.loadedAds.forEach(function(e){e.sequence||t.push(e)}),t},t.prototype.history=function(){return this._history},t.prototype.parseXmlString=function(t,e){this.ajaxComplete({responseXML:function(t){if(e=t,"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName)return t;var e;return E.utils.parseXML(t)}(t)},e)},t.prototype.ajaxComplete=function(e,i){var r=this;this.parser=this.parser||new nt;try{this.parser.parse(e.responseXML,e)}catch(t){var a=t.code||900,n=t.adErrorCode||1e4+a;return void this.sendErrorEvent(t.message,a,n,i)}var s=this.parser.parsedAds();if(s&&s.length)this.loadedAds=s,this.options.wrapper=this.options.wrapper||[],this.options.adsystem&&this.options.wrapper.push(this.options.adsystem),this.options.adsystem=this.loadedAds[0].adsystem,s.forEach(function(e){if(e.wrappedURI){r.options.wrappedTags=r.options.wrappedTags||[r._scheduledAd._currentTag],r.options.wrappedTags.push(e.wrappedURI);var i=new t(r._scheduledAd,r.player,r.options);i.on(d,function(){r.replaceWrappedAd(e,i.allAds())}),i.on(l,function(t){r.sendAdpodErrorEvent(t.message,t.code,t.adErrorCode,t.url),r.destroyWrappedAd(e,i)}),i.load(e.wrappedURI)}else r.options.wrapper.length>1&&(e.wrapper=r.options.wrapper,e.wrappedTags=r.options.wrappedTags)}),this.checkComplete();else{var o=2===this.parser.version(),h=o?900:101,p=o?60001:10101;this.sendErrorEvent("Ad Tag Empty",h,p,i)}},t.prototype.destroyWrappedAd=function(t,e){var i=this.loadedAds.indexOf(t);this.loadedAds.splice(i,1),e.destroy(),this.checkComplete()},t.prototype.replaceWrappedAd=function(t,e){var i=function(t,e){var i=[];return E.utils.foreach(e,function(e,r){t.companions&&(r.companions=(r.companions?r.companions:[]).concat(t.companions)),t.trackers&&(r.trackers=(a=r.trackers,n=t.trackers,a=a||{},E.utils.foreach(n,function(t,e){a[t]?a[t]=a[t].concat(e):a[t]=e}),a));var a,n;t.sequence&&(r.sequence=t.sequence),i.push(r)}),i}(t,e),r=this.loadedAds.indexOf(t);Array.prototype.splice.apply(this.loadedAds,[r,1].concat(i)),this.checkComplete()},t.prototype.checkComplete=function(){var t=!1;E.utils.foreach(this.loadedAds,function(e,i){i.wrappedURI&&(t=!0)}),t||this.validateVast()},t.prototype.validateVast=function(){var t=this.loadedAds.slice(0),e=t.length;t.forEach(function(e){e.media&&e.media.length||t.length--});var i=0===e,r=t.length!==e;i||r?this.sendErrorEvent("Ad Tag Empty",101,10101,this._history[this._history.length-1]):this.trigger(d,{vloader:this})},t.prototype.ajaxError=function(t,e){if(this.player.getAdBlock())this.sendErrorEvent("Ad playback blocked by an ad blocker",900,60003,e);else if("Invalid XML"===t)this.sendErrorEvent(t,100,10100,e);else if("Error loading file"===t){var i=this.options.wrappedTags&&this.options.wrappedTags.length,r=i?303:900,a=i?10303:60006;this.sendErrorEvent(t,r,a,e)}else this.sendErrorEvent("VAST could not be loaded",301,10301,e)},t.prototype.firstUrl=function(){return this._history&&this._history.length?this._history[0]:""},t.prototype.sendAdpodErrorEvent=function(t,e,i,r){if(1!==this.loadedAds.length){var a=C(t,e,i);a.vloader=this,a.url=this.firstUrl()||r,this.wrappedTags=r,this.trigger("adPodError",a)}else this.sendErrorEvent(t,e,i,r)},t.prototype.sendErrorEvent=function(t,e,i,r){if(!this.errorSent){this.errorSent=!0;var a=C(t,e,i);a.vloader=this,a.url=this.firstUrl()||r,this.options.wrappedTags&&(a.wrapperAdSystem=this.options.wrapper||"",a.wrappedTags=this.options.wrappedTags),a.adsystem=this.options.adsystem||"",this.trigger(l,a)}},t}();var mt=Date.now||function(){return(new Date).getTime()},vt=function(){function e(t,i){P(this,e),this.player=t,this.options=i,this.reset(),i.timeBetweenAds&&t.on({adBreakStart:this.handleAdBreakStart,adSkipped:this.handleAdSkipped,adComplete:this.handleAdComplete,adBreakEnd:this.handleAdBreakEnd,destroyPlugin:this.destroy},this)}return e.prototype.sendAdBreakIgnored=function(e,i){if(e){this.player.trigger(h,(a=i,{id:(r=e)._breakId,tag:r._adQueue&&r._adQueue.length>0?r._adQueue[0]:r._adXML,client:t,offset:r._offSet,timeSinceLastAd:a,type:h}));var r,a}},e.prototype.rulesAllowAdPlayback=function(t){var e=this.options,i=0===e.frequency&&1===t,r=t>=e.startOn&&(t-e.startOn)%e.frequency==0;return i||r},e.prototype.handleAdBreakStart=function(){this.adSkipped=!1,this.adComplete=!1},e.prototype.handleAdComplete=function(){this.adComplete=!0},e.prototype.handleAdSkipped=function(){this.adSkipped=!0},e.prototype.handleAdBreakEnd=function(){!this.adSkipped&&this.adComplete&&(this.recentCompletedAdTime=mt())},e.prototype.timeBetweenAdsAllowsAdPlayback=function(t){if(this.options.timeBetweenAds){var e=(mt()-this.recentCompletedAdTime)/1e3;if(e<this.options.timeBetweenAds)return this.sendAdBreakIgnored(t,e),!1}return!0},e.prototype.reset=function(){this.recentCompletedAdTime=0},e.prototype.destroy=function(){this.player.off(null,null,this)},e}(),yt={};function gt(t,e){var i=this,r=yt[e];if(r)return r;this.jwplayerEntitlements=function(t,e,i){var r={canPlayAds:!0},a=new t.key(e),n=a.edition();if("unlimited"===n)return i(r);var s=a.token(),o=["//","entitlements.jwplayer.com","/",s,".json"];"file:"===window.location.protocol&&o.unshift("https:"),t.ajax(o.join(""),function(t){r.canPlayAds=!t||!t.response||!1!==t.response.canPlayAds,i(r)},function(){i(r)},{timeout:1e4,responseType:"json"})};return yt[e]=new Promise(function(r,a){i.jwplayerEntitlements(t,e,function(t){t.canPlayAds?r():a({message:"Ad Limit Reached"})})})}var At=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/,kt=/^((https?:)?\/\/)?bid\.g\.doubleclick\.net\/dbm\/vast\?[\S]*$/,Pt=/^((https?:)?\/\/)?ad\.doubleclick\.net(\/ddm)?\/pfadx\/[\S]*$/;function Tt(t,e,i,r){if(!t)return t;var a=function(t){var e=t.getConfig();return{playerHeight:t.getHeight()||e.height||"",playerWidth:t.getWidth()||e.width||"",itemDuration:function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i}(t.getDuration(),3)||"",item:e.playlist[t.getPlaylistIndex()]||{}}}(e),n=a.item,s=window.location.href;t=wt(t=wt(t=wt(t=wt(t=wt(t=wt(t=wt(t=wt(t,"__random-number__",Math.random()*Math.pow(10,18)),"__timestamp__",(new Date).getTime()),"__page-url__",encodeURIComponent(s)),"__referrer__",encodeURIComponent(document.referrer)),"__player-height__",a.playerHeight),"__player-width__",a.playerWidth),"__item-duration__",a.itemDuration),"__domain__",encodeURIComponent(i));for(var o=(t=r.companion?wt(t,"__companion-div__",r.companion.id):wt(t,"__companion-div__","")).match(new RegExp(/__item-[a-z 0-9 A-Z]*__/g)),d=0;o&&d<o.length;d++){var l=o[d],h=l.substring(7,l.length-2);if(n.hasOwnProperty(h)&&"string"==typeof n[h]){var p=n[h];p.length>1e3&&(p=p.substring(0,1e3)),t=wt(t,l,encodeURIComponent(p))}else t=wt(t,l,"")}return t=function(t){At.test(t)||kt.test(t)?t+="&sdk3p=jwplayer":Pt.test(t)&&(t+=";sdk3p=jwplayer");return t}(t)}function wt(t,e,i){return t.replace(e,i)}function _t(t){return t._adQueue&&t._waterfallIndex<t._adQueue.length}(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(t,"8.1",function(i,s,h){var f=E.utils=i.utils,m=E._=i._,v=i.getConfig().key,y=i.getEnvironment(),g=s.debug&&s.trackFn?s.trackFn:null,A=this,k={},P=!1,w="",_=!1,b=!1,S=0,V=[],M=[],L=!1,H={},O=!1,q=-1,U=void 0,D=void 0,F=void 0,Q=void 0,W=void 0,X=void 0,z=void 0,$=0,G=0,J=new N,Y=new j,Z=new vt(i,J.getAdRules(s));this.version="8.2.0",A._qoe=new jwplayer.utils.Timer;var K=z=J.getSchedule(s,Z);z.isVMAP()&&tt(Tt(z.getVMAP(),i,Bt(),k)),T(this,i.Events),f.addClass(h,"jw-plugin-vast"),i.on({ready:function(){var r=this;P=!0,F=new it(i,h),Q=new B(g,y),k=J.getOptParams(s),Ut.catch(function(a){wt(),i.off(null,null,r),i.playAd=f.noop;var n=C("Ad Error: "+a.message,null,60002);n.code=void 0,n.id=e,n.client=t,n.tag="",i.trigger(u,n)})},beforePlay:et,cast:function(t){L=!!t.active},play:function(t){A.trigger(o,t)},time:function(t){if(!L&&0!==t.duration){var e=z.getNextMidRoll(G,t.position,t.duration);G=t.position,e&&((i=e)._position="mid",i._id=ct(12),nt(i));var i}},beforeComplete:function(){if(!L){var t=z.getPostRoll();!b&&t&&((e=t)._position="post",b=!0,i.detachMedia(),e._id=ct(12),nt(e));var e}},playlistItem:function(t){$++,G=0;var e=z;ut(t),Z.reset(),z.isVMAP()?e!==z&&tt(Tt(z.getVMAP(),i,Bt(),k)):i.trigger("adSchedule",z.getAdScheduleEventObject())},playlistComplete:ut,complete:function(){Vt(),b=!1,_=!1},destroyPlugin:wt},this),i.pauseAd=function(t){if(t="boolean"!=typeof t||t,M.length){var e=M[M.length-1];t?e.pause():e.play()}},i.playAd=function(t){O=!0,Vt();var e=void 0,i=0===k.requestTimeout?1/0:k.requestTimeout,r=0===k.creativeTimeout?1/0:k.creativeTimeout;e=Array.isArray(t)?t.slice(0):[t],nt({_id:ct(12),_adQueue:e,_waterfallIndex:0,_offset:0,_position:"api",requestTimeout:i||a,creativeTimeout:r||n})};function tt(t){t&&(X&&(Pt(X),X=null),X=f.ajax(t,function(a){X=null;try{for(var n=function(t,i){var a=[],n=st(t,"VMAP",r);if(!n.length)throw new Error("No VMAP tag in response");dt(n[0],"version")||rt(a,"VMAP Schema Error: version missing from VMAP tag",e);var s=st(t,"AdBreak",r);s.length||at();for(var o=t.lookupNamespaceURI(r),d=0;d<s.length;d++){var l={},h={},p=s[d],u=dt(p,"timeOffset"),c=dt(p,"breakId"),f=dt(p,"breakType"),m=dt(st(p,"AdSource",r)[0],"id"),v=st(p,"AdTagURI",r)[0],y=st(p,"VASTData",r)[0]||st(p,"VASTAdData",r)[0],g=dt(v,"templateType"),A=ht(v),k=ot(o,p,"Tracking",r);if(f||rt(a,"VMAP Schema Error: missing breakType on AdBreak",c),y||g||rt(a,"VMAP Schema Error: missing templateType on AdBreak",c),u||rt(a,"VMAP Schema Error: missing timeOffset on AdBreak",c),l._type=f,l._vmap={id:m,breakid:c,timeoffset:u},y)l._adXML=st(y,"VAST")[0];else{if("vast2"!==g&&"vast3"!==g&&"vast4"!==g)continue;l._adQueue=[A],l._waterfallIndex=0}var P=[];if(k)for(var T=0;T<k.length;T++){lt(h,k[T]);var w=dt(k[T],"event");P.push(w)}switch((P.indexOf("breakStart")<0||P.indexOf("breakEnd")<0||P.indexOf("error")<0)&&rt(a,"Tracking events are missing breakStart, breakEnd, or error for AdBreak",c),l._trackers=h,l._type=f,u){case"start":l._offSet="pre",i.setPreRoll(l);break;case"100%":case"end":l._offSet="post",i.setPostRoll(l);break;default:if(/^#/.test(u))break;/^\d\d?(?:\.\d+)?%$/.test(u)?l._offSet=u:l._offSet=E.utils.seconds(u),i.addMidRoll(l)}}return i.preRoll||i.midRolls.length||i.postRoll||at(),i.sort(null,!0),a}(a.responseXML,z),s=0;s<n.length;s++){var o=n[s];o.vmap=t,i.trigger(u,o)}i.trigger("adSchedule",z.getAdScheduleEventObject())}catch(i){var d=C("VMAP Schema Error: "+i.message,1002,i.adErrorCode||11002);return d.id=e,d.vmap=t,Ot(d),void Mt()}P&&(jt(z),W)&&et()&&Mt()},function(i){X=null,f.log(i),W&&Mt();var r={Timeout:1007,"Invalid XML":1e3,default:1008},a=r[i]||r.default,n=C("Error Loading VMAP Schedule",a,1e4+a);n.id=e,n.vmap=t,Ot(n)},{withCredentials:!0,retryWithoutCredentials:!0,requireValidXML:!0,timeout:z.requestTimeout}))}function et(){if(L)return!1;var t=z.getPreRoll();if(X)return pt(),!1;if(!_&&t)return(e=t)._position="pre",_=!0,e._id=ct(12),nt(e),!1;var e;return!0}function nt(t){w=t._position,D=t._vmapTracker=(e=t,e._vmapTracker||new I(e._trackers,g,i));var e;clearTimeout(q),q=-1,"nonlinear"!==t._type&&(W||pt()),t._adXML?(t._currentTag=t._currentTag||"clientloadedtag_"+S++,(r=t)._currentTag=r._currentTag||r._adXML.toString(),At(r).parseXmlString(r._adXML),mt(r,r._currentTag)):t._adQueue?function(t){H=t;var e=t._waterfallIndex||0,r=t._adQueue[e],a=Tt(r,i,Bt(),k);t._waterfallIndex=e+1,t._currentTag=a,"function"==typeof g&&g({type:"tagReplacement",data:{actualTag:a,originalTag:r}}),At(t).load(a),mt(t,a)}(t):(f.log("scheduled ad has no url or xml",t),Mt());var r}function pt(){W=i.createInstream().init(),A.trigger("blockingStarted")}function ut(t){var e=i.getPlaylistItem(t.index);z=Z.rulesAllowAdPlayback($)?m.isObject(e)&&e.adschedule?J.getSchedule(e,Z):K:Y,It(),Ct(),Vt(),b=!1,_=!1,jt(z),z.reset()}function ct(t){return new Array(t+1).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,t)}function mt(t,e){i.trigger("adRequest",yt(t,e)),A._qoe.tick("adLoading"+t._id)}function yt(t,e){var i=t._adQueue||{},r={},a=t.adbreakid,n=t._adTagQueue,s=t.skipoffset;if(a&&(r.adbreakid=a),n){var o=t._waterfallIndex-1;o=o<0?0:o,r.adtagid=n[o]}return m.isUndefined(s)||(r.skipoffset=s),T(r,{id:t._id,tag:e||t._currentTag,client:"vast",adposition:t._position,offset:t._offSet,witem:t._waterfallIndex||1,wcount:i.length||1})}function At(t){var e=new ft(t,i);return e.on(d,Et),e.on(l,Ht),e.on("adPodError",Lt),V.push(e),W&&!D.breakStarted&&(W.on("destroyed",function(){D&&D.breakStarted&&(D.breakEnd(),i.trigger("adBreakEnd",x("adBreakEnd",i,w)))}),D.breakStart(),i.trigger("adBreakStart",x("adBreakStart",i,t._position))),e}function kt(t){for(var e=V.length;e--;)V[e]===t&&(V.splice(e,1),t.destroy())}function Pt(t){t.onload=null,t.onreadystatechange=null,t.onerror=null,"abort"in t&&t.abort()}function wt(){X&&(Pt(X),X=null),It(),Ct(),Vt(),i.setCues([])}function Et(t){var e=t.vloader.scheduledAd();W||"nonlinear"===e._type?bt(t):(A.off("blockingStarted"),A.once("blockingStarted",function(){bt(t)}))}function bt(t){var e=t.vloader;clearTimeout(q),q=-1,H.isWaterfalling||Vt(),kt(e);var r=new R(e,i,F,Q,k,g);r.on(u,St),r.on(c,xt),r.on("adPodError",Ot),r.init(W)?(U=W,W=null,A.off("blockingStarted"),r.on(p,Rt),M.push(r)):r.destroy()}function It(){for(var t=V.length;t--;){var e=V[t];V.length--,e.destroy()}}function Ct(){for(var t=M.length;t--;){var e=M[t];M.length--,e.destroy()}}function St(t){O=!1,Ot(t),O||!_t(H)?(Ct(),O=!1,q=setTimeout(function(){q=-1,0===V.length&&("post"===w&&i.attachMedia(),Mt())},0)):(W=W||U,nt(T({},H,{_offset:0,isWaterfalling:!0})))}function xt(t){H={},qt(t)&&(A._qoe.tick("adImpression"+t.id),t.timeLoading=A._qoe.between("adLoading"+t.id,"adImpression"+t.id)),i.trigger(c,t)}function Rt(){0===V.length&&"post"===w&&i.attachMedia()}function Vt(){M.length&&M[M.length-1].clearNonlinear()}function Mt(){if(W||U){var t=W||U;W=null,t.destroy(),A.off("blockingStarted")}U=null}function Lt(t){var e=yt(t.vloader.scheduledAd(),t.url),i=C(t.message,t.code,t.adErrorCode);T(e,i),t.wrappedTags&&t.wrappedTags!==t.url&&(t.wrapperAdSystem&&t.wrapperAdSystem.length!==t.wrappedTags.length&&(t.wrapperAdSystem.push(t.adsystem),t.adsystem=""),e.tag=t.wrappedTags.pop(),e.wrappedTags=t.wrappedTags,e.adsystem=t.adsystem,e.wrapperAdSystem=t.wrapperAdSystem),O=!1,Ot(e)}function Ht(t){var e=t.vloader,r=e.allAds();if(kt(e),r&&r.length){var a=r[0];if(a){var n=a.trackers;n&&n.error&&new I(n,g,i).error(t.code)}}Lt(t),O||!_t(H)?(Ct(),O=!1,-1===q&&(q=setTimeout(function(){q=-1,0===V.length&&Mt()},0))):nt(T({},H,{_offset:0,isWaterfalling:!0}))}function Ot(e){qt(e)&&(A._qoe.tick("adError"+e.id),e.timeLoading=A._qoe.between("adLoading"+e.id,"adError"+e.id)),T(e,{client:t}),D&&D.error(e.code),P?i.trigger(u,e):i.once("playlistItem",function(){i.trigger(u,e)},A)}function Bt(){var t=window.location.href;return(t=t.match(new RegExp(/^[^/]*:\/\/\/?([^\/]*)/)))&&t.length>1?t[1]:""}function qt(t){return"pre"===t.adposition&&(void 0===t.podcount||1===t.sequence)}function jt(t){var e=t.getMidRolls(),r=[];e.length&&f.foreach(e,function(t,e){"nonlinear"!==e._type&&r.push({begin:e._offSet,text:k.cuetext})}),i.setCues(r)}var Ut=gt.call(this,f,v);Ut.catch(f.noop),this.destroy=wt})}();
